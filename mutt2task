#!/usr/bin/env sh

message_id="$(awk -F"[<>]" 'tolower($0) ~ /^message-id: / { print $2; exit }')"

case "$1" in
	"find")
		if ! task "$message_id" list 1>&2; then
			echo "no task found" 1>&2
		fi
		exit 1
		;;
	"add")
		printf "task description: " 1>&2
		read description 0>&2
		if [ "$description" ] ; then 
			task_number="$(task add "$description" \
								| awk -F"[ .]" '{ print $3 }')"
			if [ "$task_number" ] && [ "$message_id" ]; then
					task "$task_number" annotate "$message_id" 1>/dev/null 2>&1
			fi
		fi
		;;
	*)
		;;
esac
